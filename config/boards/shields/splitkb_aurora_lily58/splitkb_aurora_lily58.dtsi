/*
 * Copyright (c) 2022 The ZMK Contributors
 *
 * SPDX-License-Identifier: MIT
 */

#include <dt-bindings/zmk/matrix_transform.h>
#include <physical_layouts.dtsi>

/ {
    chosen {
        zmk,physical-layout = &default_layout;
    };

    default_layout: default_layout {
        compatible = "zmk,physical-layout";
        display-name = "Aurora Lily58";
        transform = <&default_transform>;
        keys
            /* Row 0 */
            = <&key_physical_attrs 100 100   0   0 0 0 0> // L00
            , <&key_physical_attrs 100 100 100   0 0 0 0> // L01
            , <&key_physical_attrs 100 100 200   0 0 0 0> // L02
            , <&key_physical_attrs 100 100 300   0 0 0 0> // L03
            , <&key_physical_attrs 100 100 400   0 0 0 0> // L04
            , <&key_physical_attrs 100 100 500   0 0 0 0> // L05
            , <&key_physical_attrs 100 100 800   0 0 0 0> // R00
            , <&key_physical_attrs 100 100 900   0 0 0 0> // R01
            , <&key_physical_attrs 100 100 1000  0 0 0 0> // R02
            , <&key_physical_attrs 100 100 1100  0 0 0 0> // R03
            , <&key_physical_attrs 100 100 1200  0 0 0 0> // R04
            , <&key_physical_attrs 100 100 1300  0 0 0 0> // R05
            /* Row 1 */
            , <&key_physical_attrs 100 100   0 100 0 0 0> // L10
            , <&key_physical_attrs 100 100 100 100 0 0 0> // L11
            , <&key_physical_attrs 100 100 200 100 0 0 0> // L12
            , <&key_physical_attrs 100 100 300 100 0 0 0> // L13
            , <&key_physical_attrs 100 100 400 100 0 0 0> // L14
            , <&key_physical_attrs 100 100 500 100 0 0 0> // L15
            , <&key_physical_attrs 100 100 800 100 0 0 0> // R10
            , <&key_physical_attrs 100 100 900 100 0 0 0> // R11
            , <&key_physical_attrs 100 100 1000 100 0 0 0> // R12
            , <&key_physical_attrs 100 100 1100 100 0 0 0> // R13
            , <&key_physical_attrs 100 100 1200 100 0 0 0> // R14
            , <&key_physical_attrs 100 100 1300 100 0 0 0> // R15
            /* Row 2 */
            , <&key_physical_attrs 100 100   0 200 0 0 0> // L20
            , <&key_physical_attrs 100 100 100 200 0 0 0> // L21
            , <&key_physical_attrs 100 100 200 200 0 0 0> // L22
            , <&key_physical_attrs 100 100 300 200 0 0 0> // L23
            , <&key_physical_attrs 100 100 400 200 0 0 0> // L24
            , <&key_physical_attrs 100 100 500 200 0 0 0> // L25
            , <&key_physical_attrs 100 100 800 200 0 0 0> // R20
            , <&key_physical_attrs 100 100 900 200 0 0 0> // R21
            , <&key_physical_attrs 100 100 1000 200 0 0 0> // R22
            , <&key_physical_attrs 100 100 1100 200 0 0 0> // R23
            , <&key_physical_attrs 100 100 1200 200 0 0 0> // R24
            , <&key_physical_attrs 100 100 1300 200 0 0 0> // R25
            /* Row 3 */
            , <&key_physical_attrs 100 100   0 300 0 0 0> // L30
            , <&key_physical_attrs 100 100 100 300 0 0 0> // L31
            , <&key_physical_attrs 100 100 200 300 0 0 0> // L32
            , <&key_physical_attrs 100 100 300 300 0 0 0> // L33
            , <&key_physical_attrs 100 100 400 300 0 0 0> // L34
            , <&key_physical_attrs 100 100 500 300 0 0 0> // L35
            , <&key_physical_attrs 100 100 600 350 0 0 0> // L36 (Inner Thumb)
            , <&key_physical_attrs 100 100 700 350 0 0 0> // R36 (Inner Thumb)
            , <&key_physical_attrs 100 100 800 300 0 0 0> // R30
            , <&key_physical_attrs 100 100 900 300 0 0 0> // R31
            , <&key_physical_attrs 100 100 1000 300 0 0 0> // R32
            , <&key_physical_attrs 100 100 1100 300 0 0 0> // R33
            , <&key_physical_attrs 100 100 1200 300 0 0 0> // R34
            , <&key_physical_attrs 100 100 1300 300 0 0 0> // R35
            /* Row 4 (Thumbs) */
            , <&key_physical_attrs 100 100 150 400 0 0 0> // T1
            , <&key_physical_attrs 100 100 250 400 0 0 0> // T2
            , <&key_physical_attrs 100 100 350 400 0 0 0> // T3
            , <&key_physical_attrs 100 100 450 400 0 0 0> // T4
            , <&key_physical_attrs 100 100 850 400 0 0 0> // T5
            , <&key_physical_attrs 100 100 950 400 0 0 0> // T6
            , <&key_physical_attrs 100 100 1050 400 0 0 0> // T7
            , <&key_physical_attrs 100 100 1150 400 0 0 0> // T8
            ;
    };

    default_transform: keymap_transform_0 {
        compatible = "zmk,matrix-transform";
        columns = <12>;
        rows = <5>;
        map = <
RC(0,0) RC(0,1) RC(0,2) RC(0,3) RC(0,4) RC(0,5)                 RC(0,6) RC(0,7) RC(0,8) RC(0,9) RC(0,10) RC(0,11)
RC(1,0) RC(1,1) RC(1,2) RC(1,3) RC(1,4) RC(1,5)                 RC(1,6) RC(1,7) RC(1,8) RC(1,9) RC(1,10) RC(1,11)
RC(2,0) RC(2,1) RC(2,2) RC(2,3) RC(2,4) RC(2,5)                 RC(2,6) RC(2,7) RC(2,8) RC(2,9) RC(2,10) RC(2,11)
RC(3,0) RC(3,1) RC(3,2) RC(3,3) RC(3,4) RC(3,5) RC(4,1) RC(4,10) RC(3,6) RC(3,7) RC(3,8) RC(3,9) RC(3,10) RC(3,11)
                        RC(4,2) RC(4,3) RC(4,4) RC(4,5) RC(4,6) RC(4,7) RC(4,8) RC(4,9)
        >;
    };

    left_encoder: left_encoder {
        compatible = "alps,ec11";
        steps = <80>;
        status = "disabled";
        a-gpios = <&pro_micro 5 GPIO_PULL_UP>;
        b-gpios = <&pro_micro 4 GPIO_PULL_UP>;
    };

    right_encoder: right_encoder {
        compatible = "alps,ec11";
        steps = <80>;
        status = "disabled";
        a-gpios = <&pro_micro 18 GPIO_PULL_UP>;
        b-gpios = <&pro_micro 19 GPIO_PULL_UP>;
    };

    sensors: sensors {
        compatible = "zmk,keymap-sensors";
        sensors = <&left_encoder &right_encoder>;
        triggers-per-rotation = <20>;
    };
};

#ifndef IS_DONGLE
/ {
    chosen {
        zephyr,display = &oled;
    };
};

&pro_micro_i2c {
    status = "okay";
    oled: ssd1306@3c {
        compatible = "solomon,ssd1306fb";
        reg = <0x3c>;
        width = <128>;
        height = <32>;
        segment-offset = <0>;
        page-offset = <0>;
        display-offset = <0>;
        multiplex-ratio = <31>;
        segment-remap;
        com-invdir;
        com-sequential;
        inversion-on;
        prechargep = <0x22>;
    };
};
#endif